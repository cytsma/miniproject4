---
title: "Mini Project 4"
author: "Cai Ytsma, Juliane Bombosch, Sofia Salcedo"
date: "April 27, 2018"
output: html_document
---

  A new epidemic has arisen, striking fear into the hearts of New York City Taxi drivers. This epidemic goes by many aliases, the most well known one being "Uber." 
  
#Background
  Uber is a peer-to-peer ridesharing, food delivery, and transportation network company with operations in 633 cities worldwide. It was officially launched in June 2010. Between 2011 and 2015, Uber has provided around 82,000 rides per day in New York City. By 2015, Uber was been named one of the most valuable startup companies in the world by Business insider.
  A multitude of recent articles claim that businesses like Uber are putting financial stresses on Taxi drivers. Forbes Business claims that the hourly earnings of Uber drivers are 23.68 dollars and the hourly earnings of taxi drivers are 12.54 dollars. This does not consider external side costs. For example, that a taxi driver must pay to have taxi certificate of compliance. 
  
#Our Research


#Future Aspects
  In the future we would like to compare how many taxis were hailed in 2009 versus 2015 when Uber

  Resources: 
  http://www.businessinsider.com/history-of-uber-and-its-rise-to-become-the-most-valuable-startup-in-the-world-2015-9
  https://www.forbes.com/sites/niallmccarthy/2016/11/28/fare-deal-how-the-hourly-earnings-of-uber-and-taxi-drivers-measure-up-infographic/#4841d2a1689a

COMPARING APRIL 2005 and APRIL 2015

JFK = 132
Using taxi and plane data, joining databases? To see connections between taxi and plane, in the shadow of ride sharing services.


```{r}
#calling the libraries
library(tidyverse)
library(mdsr)
library(RMySQL)
nyctaxi <- dbConnect_scidb(dbname = "nyctaxi")
airlines <- dbConnect_scidb(dbname = "airlines")
```

Sofia goals: gathering Uber and lyft info
1. create a database that has the dates of the information from Uber and lyft info
What am I trying to get out of that? 
- how many trips were made per day for each


```{r}
uber_jfk_april <- read.csv("./uber-raw-data-april153.csv")

uber_jfk_april <- uber_jfk_april %>%
  rename(location_code = `X255`) %>%
  rename(day = `X4.1.15.0.02`)%>%
  filter(location_code == 132) %>%
  #split the day column and get rid of it
  

uber_april_2015

#need to group everything into day
#but the column also has time of day
#just want the number per day

  
uber_jfk_april

```

for finding the location of the airport, try using PULocationID in the "yellow" taxi data

----------
Cai goals:

OVERALL GRAPH: line showing max number of people leaving per day

underneath: stacked bar graph to see if number of people getting rides matches number of people leaving airport

within bar - colors corresponding to taxi/uber to see which one has the majority

THEN: analyze percentage of people being picked up vs number of people leaving airport

  -delineate by taxi and uber for 2015 and compare to see if percentage of people picked up by taxi went down

```{r, label = "find most average flight month"}
popular_months <- airlines %>%
  dbGetQuery("SELECT month, SUM(1) AS sum
FROM airlines.flights
WHERE dest = 'JFK'
GROUP BY month
ORDER BY sum DESC;")


deviation <- popular_months %>%
  summarize(mean = sum(sum)/12)

mean <- deviation[[1]]

most_avg_month <- popular_months %>%
  mutate(near_avg = abs((sum/mean) - 1)) %>%
  arrange(near_avg) %>%
  head(1)
```

```{r, label = "get flight info"}
flights <- airlines %>%
  dbGetQuery("SELECT f.year, f.day, f.tailnum, f.dest, p.seats FROM airlines.flights f
INNER JOIN airlines.planes p
	ON p.tailnum = f.tailnum
WHERE f.year IN (2009, 2015)
AND f.month = 4
AND f.dest IN ('JFK', 'EWR');")
```

```{r, label = "max number of people leaving per day"}
people_per_day <- flights %>% 
  group_by(dest, year, day) %>%
  summarize(num_people = sum(seats))

ewr_people <- people_per_day %>%
  filter(dest == "EWR")

jfk_people <- people_per_day %>%
  filter(dest == "JFK")
```

```{r}
#TEST PLOT
ewr_plot <- ggplot(data = ewr_people, aes(x = day, y = num_people)) +
  geom_line(data = (ewr_people %>% filter(year == 2015))) +
  geom_line(data = (ewr_people %>% filter(year == 2009)), color = "red") +
  theme(panel.grid = element_blank(),
        panel.background = element_blank()) 

ewr_plot
```

```{}

