---
title: "Mini Project 4"
author: "Cai Ytsma, Juliane Bombosch, Sofia Salcedo"
date: "April 27, 2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
    
---

##
  A new epidemic has arisen, striking fear into the hearts of New York City Taxi drivers. This epidemic goes by many aliases, the most well known ones being "Uber" and "Lyft." Uber was officially launched in June 2010. Between 2011 and 2015, Uber has provided around 82,000 rides per day in New York City. By 2015, Uber was been named one of the most valuable startup companies in the world by Business insider. 

***COMPARING JFK AND EWR IN JANUARY 2017***


```{r echo = FALSE warning = FALSE}
#calling the libraries
library(tidyverse)
library(mdsr)
library(RMySQL)
library(ggplot2)
nyctaxi <- dbConnect_scidb(dbname = "nyctaxi")
airlines <- dbConnect_scidb(dbname = "airlines")
```

```{r echo = FALSE warning = FALSE} 
uber_jan <- read.csv("./jan2015uber.csv")

uber_jfk_jan <- uber_jan %>%
  filter(locationID == 132) %>%
  group_by(Date) %>%
  summarise(rides_per_day = n()) 



uber_ewr_jan <- read.csv("./jan2015uber.csv")

uber_ewr_jan <- uber_jan %>%
  filter(locationID == 1) %>%
  group_by(Date) %>%
  summarise(rides_per_day = n())

ggplot(uber_jfk_jan, aes(x = Date, y = rides_per_day)) +
  geom_point()
ggplot(uber_ewr_jan, aes(x = Date, y = rides_per_day)) +
  geom_point()

```




----------
Cai goals:

OVERALL GRAPH: line showing max number of people leaving per day

underneath: stacked bar graph to see if number of people getting rides matches number of people leaving airport

within bar - colors corresponding to taxi/uber to see which one has the majority

THEN: analyze percentage of people being picked up vs number of people leaving airport

  -delineate by taxi and uber for 2015 and compare to see if percentage of people picked up by taxi went down


#popular_months <- airlines %>%
#  dbGetQuery("SELECT month, SUM(1) AS sum
#FROM airlines.flights
#WHERE dest = 'JFK'
#GROUP BY month
#ORDER BY sum DESC;")


#deviation <- popular_months %>%
#  summarize(mean = sum(sum)/12)

#mean <- deviation[[1]]

#most_avg_month <- popular_months %>%
#  mutate(near_avg = abs((sum/mean) - 1)) %>%
#  arrange(near_avg) %>%
#  head(1)


```{r, label = "get flight info" warning = FALSE echo = FALSE}
ny_flights_2017 <- airlines %>%
  dbGetQuery("SELECT f.day, f.dest, p.seats FROM airlines.flights f
INNER JOIN airlines.planes p
	ON p.tailnum = f.tailnum
WHERE f.year = 2017
AND f.month = 1
AND f.dest in ('JFK', 'EWR');")
```

```{r, label = "max number of people leaving per day" echo = FALSE warning = FALSE}
people_per_day <- ny_flights_2017 %>% 
  group_by(dest, day) %>%
  summarize(num_people = sum(seats))

ewr_people <- people_per_day %>%
  filter(dest == "EWR")

jfk_people <- people_per_day %>%
  filter(dest == "JFK")
```

```{r}
#TEST PLOT
ewr_plot <- ggplot(data = ewr_people, aes(x = day, y = num_people)) +
  geom_line() +
  theme(panel.grid = element_blank(),
        panel.background = element_blank()) +
  geom_bar(data = uber_ewr_jan)

ewr_plot
```
