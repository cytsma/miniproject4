---
title: "Mini Project 4"
author: "Cai Ytsma, Juliane Bombosch, Sofia Salcedo"
date: "April 27, 2018"
output: html_document
---
COMPARING APRIL 2005 and APRIL 2015

JFK = 132
Using taxi and plane data, joining databases? To see connections between taxi and plane, in the shadow of ride sharing services.


```{r}
#calling the libraries
library(tidyverse)
library(mdsr)
library(RMySQL)
nyctaxi <- dbConnect_scidb(dbname = "nyctaxi")
airlines <- dbConnect_scidb(dbname = "airlines")
```

Sofia goals: gathering Uber and lyft info
1. create a database that has the dates of the information from Uber and lyft info
What am I trying to get out of that? 
- how many trips were made per day for each


```{r}
uber_april_2015 <- read.csv("./uber-raw-data-april153.csv")

uber_april_2015 <- uber_april_2015 %>%
  rename(location_code = `X255`) %>%
  rename(day = `X4.1.15.0.02`)%>%
  filter(location_code == 132)
#need to group everything into day
  
  
uber_april_2015
```

for finding the location of the airport, try using PULocationID in the "yellow" taxi data

----------
Cai goals:

OVERALL GRAPH: line showing max number of people leaving per day

underneath: stacked bar graph to see if number of people getting rides matches number of people leaving airport

within bar - colors corresponding to taxi/uber to see which one has the majority

THEN: analyze percentage of people being picked up vs number of people leaving airport

  -delineate by taxi and uber for 2015 and compare to see if percentage of people picked up by taxi went down

```{r, label = "find most average flight month"}
popular_months <- airlines %>%
  dbGetQuery("SELECT month, SUM(1) AS sum
FROM airlines.flights
WHERE dest = 'JFK'
GROUP BY month
ORDER BY sum DESC;")


deviation <- popular_months %>%
  summarize(mean = sum(sum)/12)

mean <- deviation[[1]]

most_avg_month <- popular_months %>%
  mutate(near_avg = abs((sum/mean) - 1)) %>%
  arrange(near_avg) %>%
  head(1)
```

```{r, label = "get flight info"}
flights <- airlines %>%
  dbGetQuery("SELECT f.year, f.day, f.tailnum, p.seats FROM airlines.flights f
INNER JOIN airlines.planes p
	ON p.tailnum = f.tailnum
WHERE f.year IN (2009, 2015)
AND f.month = 4
AND f.dest IN ('JFK', 'EWR');")
```

```{r, label = "max number of people leaving per day"}
people_per_day <- flights %>% 
  group_by(year, month, day) %>%
  summarize(num_people = sum(seats)) 
```



