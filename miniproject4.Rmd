---
title: "Mini Project 4"
author: "Cai Ytsma, Juliane Bombosch, Sofia Salcedo"
date: "April 27, 2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
---

##
  A new epidemic has arisen, striking fear into the hearts of New York City Taxi drivers. This epidemic goes by many aliases, the most well known ones being "Uber" and "Lyft." Uber was officially launched in June 2010. Between 2011 and 2015, Uber has provided around 82,000 rides per day in New York City. By 2015, Uber was been named one of the most valuable startup companies in the world by Business Insider.
  
 Ride sharing is so successful because it’s simple and marketed as the cheaper option. This is true about long trips, but not necessarily for short trips (94% of Uber trips) and surge pricing makes this option even more expensive in comparison to taxis. 
 
http://time.com/3556741/uber/

So why is Uber the popular option? 
1.Uber uses an app instead of physically hailing a cab. For many people, this is more accessible- whether it’s because they are more comfortable with using technology or it removes the physical problem of hailing a cab (hailing a cab brings out both issues of disability as well as racial profiling on both the driver and passenger front).

2.You can estimate the cost beforehand. In taxis, there is little clarity before the ride about how expensive the ride will be. While it is an estimate, passengers can see whether they are getting a surge price, how long it will take, and this information is comforting to a lot of passengers. 

3.The people who drive for Uber are a wider pool of people than career taxi drivers. (conversation)

4.It’s faster. With the number of Uber drivers compared to taxi drivers, the wait for an Uber is shorter. And in a world where time is money, the number of minutes that you wait for a ride counts.

How does this translate to New York City and airports? 

New York City has a lot of airports, which require a high number of taxis and ride-sharing to pick up the passengers. Two airports- Newark and John F. Kennedy can provide an example of the competition between Uber and taxis. JFK airport is 16 miles east of midtown Manhattan, located in Jamaica, Queens. Newark is 15 miles outside of New York City, 18 miles away from Midtown. This doesn’t appear to be a significant difference, but the time, and the fare dependent on that time, can be a big difference. 

Because of the fierce competition, other airports, like LAX in Los Angeles, have put restrictions on ride-sharing services that are not present for taxis in the same area. These restrictions include only being allowed to drive and pick up passengers in certain areas as well as not being allowed to wait for passengers. These restrictions make taxis the preferred method at LAX, unlike the rest of the city.


***COMPARING JFK AND EWR IN JANUARY 2017***


```{r, echo = FALSE, warning = FALSE}
#calling the libraries
library(tidyverse)
library(mdsr)
library(RMySQL)
library(extrafont)

#define databases
nyctaxi <- dbConnect_scidb(dbname = "nyctaxi")
airlines <- dbConnect_scidb(dbname = "airlines")
uber_jan <- read.csv("./jan2015uber.csv")

j01 <- read.csv("./TaxiJan2017_o1.csv")
j02 <- read.csv("./TaxiJan2017_o2.csv")
j03 <- read.csv("./TaxiJan2017_o3.csv")
j04 <- read.csv("./TaxiJan2017_o4.csv")
j05 <- read.csv("./TaxiJan2017_o5.csv")
j06 <- read.csv("./TaxiJan2017_o6.csv")
j07 <- read.csv("./TaxiJan2017_o7.csv")
j08 <- read.csv("./TaxiJan2017_o8.csv")
j09 <- read.csv("./TaxiJan2017_o9.csv")
j10 <- read.csv("./TaxiJan2017_10.csv")
j11 <- read.csv("./TaxiJan2017_11.csv")
j12 <- read.csv("./TaxiJan2017_12.csv")
j13 <- read.csv("./TaxiJan2017_13.csv")
j14 <- read.csv("./TaxiJan2017_14.csv")
j15 <- read.csv("./TaxiJan2017_15.csv")
j16 <- read.csv("./TaxiJan2017_16.csv")
j17 <- read.csv("./TaxiJan2017_17.csv")
j18 <- read.csv("./TaxiJan2017_18.csv")
j19 <- read.csv("./TaxiJan2017_19.csv")
j20 <- read.csv("./TaxiJan2017_20.csv")
j21 <- read.csv("./TaxiJan2017_21.csv")
j22 <- read.csv("./TaxiJan2017_22.csv")
j23 <- read.csv("./TaxiJan2017_23.csv")
j24 <- read.csv("./TaxiJan2017_24.csv")
j25 <- read.csv("./TaxiJan2017_25.csv")
j26 <- read.csv("./TaxiJan2017_26.csv")
j27 <- read.csv("./TaxiJan2017_27.csv")
j28 <- read.csv("./TaxiJan2017_28.csv")
j29 <- read.csv("./TaxiJan2017_29.csv")
j30 <- read.csv("./TaxiJan2017_30.csv")
j31 <- read.csv("./TaxiJan2017_31.csv")
```

UBER DATA
```{r, echo = FALSE, warning = FALSE} 
#jfk
uber_jfk_jan <- uber_jan %>%
  filter(locationID == 132) %>%
  group_by(day) %>%
  summarise(n_rides = n()) %>%
  mutate(airport = "JFK")

#newark
uber_ewr_jan <- uber_jan %>%
  filter(locationID == 1) %>%
  group_by(day) %>%
  summarise(n_rides = n()) %>%
  mutate(airport = "EWR")

#combine
uber_rides <- uber_jfk_jan %>%
  full_join(uber_ewr_jan, by = c("airport","day", "n_rides")) %>%
  mutate(ride_type = "uber")
```
TAXI

```{r, label = "total taxi rides from JFK per day" warning = FALSE echo= FALSE}
total_rides_j01 <- j01 %>%
  nrow()

total_rides_j01
filename_list <- c("./TaxiJan2017_o1.csv", "./TaxiJan2017_o2.csv", "./TaxiJan2017_o3.csv", "./TaxiJan2017_o4.csv")

totalrides_day <- function(file){
  df <- read.csv(file)
  df%>%
  summarise(N = n)
  return(temp_K)
}

lapply(filename_list, totalrides_day)


```


AIRPORT DATA
```{r, label = "get flight info", warning = FALSE, echo = FALSE}
#get flight data from MySQL
ny_flights_jan <- airlines %>%
  dbGetQuery("SELECT f.day, f.dest, p.seats FROM airlines.flights f
INNER JOIN airlines.planes p
	ON p.tailnum = f.tailnum
WHERE f.year = 2017
AND f.month = 1
AND f.dest in ('JFK', 'EWR');")

#estimate number of people leaving per day
people_per_day <- ny_flights_jan %>% 
  group_by(dest, day) %>%
  summarize(n_people = sum(seats), num_flights = n()) %>%
  ungroup() %>%
  mutate(flight_qual = n_people / 50, airport = dest)
```

COMBINE DATASETS
```{r, echo = FALSE, warning = FALSE}
air_uber <- people_per_day %>%
  full_join(uber_rides, by = c("day", "airport"))
```

MAKE PLOT
```{r, echo = FALSE, warning = FALSE}
ggplot(data = air_uber, aes(x = day)) +
  geom_line(aes(y = flight_qual), alpha = 0.5) +
  geom_bar(aes(y = n_rides, fill = ride_type), stat = "identity") +
  theme(panel.grid = element_blank(),
        panel.background = element_blank(),
        text = element_text(family = "Century Schoolbook")) +
    scale_y_continuous("Number of Rides") +
    scale_x_continuous("Day") +
    ggtitle("January 2017") +
  facet_wrap(~airport, ncol = 1)
```

OLD STUFF:
calculated most average month
#popular_months <- airlines %>%
#  dbGetQuery("SELECT month, SUM(1) AS sum
#FROM airlines.flights
#WHERE dest = 'JFK'
#GROUP BY month
#ORDER BY sum DESC;")

#deviation <- popular_months %>%
#  summarize(mean = sum(sum)/12)

#mean <- deviation[[1]]

#most_avg_month <- popular_months %>%
#  mutate(near_avg = abs((sum/mean) - 1)) %>%
#  arrange(near_avg) %>%
#  head(1)

In trying to turn a string into just a day of a filtered month in the data package *nyctaxi yellow #2017* I couldn't figure out a way to select a string from **tpep_pickup_datetime** without losing all of the data atatched to it or to make a function that would be able to delete the first and last part of the string only leaving the date. The package was also so big that even with 50,000 rows I was not able to have all the days of the month included.
#SELECT * 
#FROM nyctaxi.yellow
#WHERE tpep_pickup_datetime LIKE  '%2017-03%';

#SELECT
#SUBSTRING_INDEX('2017-03-09 21:30:11', ' ' , -1)
#;
#SELECT
#SUBSTRING_INDEX('09 21:30:11', ' ' , 1)
#;
#SELECT
#SUBSTRING_INDEX('09', '0', -1)
#;
#SELECT RIGHT('2017-03-09 21:30:11', 11) 
#;
#SELECT LEFT('09 21:30:11', 2);
