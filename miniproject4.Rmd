---
title: "Mini Project 4"
author: "Cai Ytsma, Juliane Bombosch, Sofia Salcedo"
date: "April 27, 2018"
output: 
  html_document:
    code_folding: hide
    df_print: paged
---

##
  A new epidemic has arisen, striking fear into the hearts of New York City Taxi drivers. This epidemic goes by many aliases, the most well known ones being "Uber" and "Lyft." Uber was officially launched in June 2010. Between 2011 and 2015, Uber has provided around 82,000 rides per day in New York City. By 2015, Uber was been named one of the most valuable startup companies in the world by Business Insider. 
  

***COMPARING JFK AND EWR IN JANUARY 2017***


```{r, echo = FALSE, warning = FALSE}
#calling the libraries
library(tidyverse)
library(mdsr)
library(RMySQL)
library(extrafont)

#define databases
nyctaxi <- dbConnect_scidb(dbname = "nyctaxi")
airlines <- dbConnect_scidb(dbname = "airlines")
uber_jan <- read.csv("./jan2015uber.csv")
```

UBER DATA
```{r echo = FALSE warning = FALSE} 
#jfk
uber_jfk_jan <- uber_jan %>%
  filter(locationID == 132) %>%
  group_by(day) %>%
  summarise(uber_ride_n = n()) %>%
  mutate(airport = "JFK")

#newark
uber_ewr_jan <- uber_jan %>%
  filter(locationID == 1) %>%
  group_by(day) %>%
  summarise(uber_ride_n = n()) %>%
  mutate(airport = "EWR")

uber_rides <- uber_jfk_jan %>%
  full_join(uber_ewr_jan, by = c("airport","day", "uber_ride_n"))
```

AIRPORT DATA
```{r, label = "get flight info" warning = FALSE echo = FALSE}
ny_flights_jan <- airlines %>%
  dbGetQuery("SELECT f.day, f.dest, p.seats FROM airlines.flights f
INNER JOIN airlines.planes p
	ON p.tailnum = f.tailnum
WHERE f.year = 2017
AND f.month = 1
AND f.dest in ('JFK', 'EWR');")
```

```{r, label = "max number of people leaving per day", echo = FALSE, warning = FALSE}
people_per_day <- ny_flights_jan %>% 
  group_by(dest, day) %>%
  summarize(flight_people = sum(seats), num_flights = n()) %>%
  ungroup() %>%
  mutate(flight_qual = flight_people / 10, airport = dest) %>%
  select(-dest)
```

```{r}
air_uber <- people_per_day %>%
  full_join(uber_rides, by = c("day", "airport"))


```

PLOTS
```{r, label = "make plots!"}
JOIN ALL DATASETS! then do:
  #geom_bar(data = RIDE_INFO, x = day, y = num_rides, fill = type, stat = "identity")

base_plot <- ggplot() +
    theme(panel.grid = element_blank(),
        panel.background = element_blank(),
        text = element_text(family = "Century Schoolbook")) +
    scale_y_continuous("Number of Rides") +
    scale_x_continuous("Day") +
    ggtitle("Newark Airport", subtitle = "January 2017")

ewr_plot <- base_plot +
  geom_line(data = ewr_people, aes(x = day, y = num_qual), alpha = 0.5)
  #barplot

jfk_plot<- base_plot +
  geom_line(data = jfk_people, aes(x = day, y = num_qual), alpha = 0.5)
  #barplot

jfk_plot
ewr_plot
```


OLD STUFF:
calculated most average month
#popular_months <- airlines %>%
#  dbGetQuery("SELECT month, SUM(1) AS sum
#FROM airlines.flights
#WHERE dest = 'JFK'
#GROUP BY month
#ORDER BY sum DESC;")

#deviation <- popular_months %>%
#  summarize(mean = sum(sum)/12)

#mean <- deviation[[1]]

#most_avg_month <- popular_months %>%
#  mutate(near_avg = abs((sum/mean) - 1)) %>%
#  arrange(near_avg) %>%
#  head(1)

got stuck doing both but tried to just alter the original Uber data to get the final thing
#temp <- uber_jan %>%
# filter(locationID == 132 | locationID == 1) %>%
#  mutate(replace(locationID, locationID == 132, "JFK"), replace(locationID, locationID == 1, "EWR"))